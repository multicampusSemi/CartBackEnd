<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.project.mapper.LjmSemiMapper">

<resultMap id="productResultMap" type="com.project.model.Products">
        <result property="product_id" column="productId"/>
        <result property="product_name" column="productName"/>
        <result property="product_code" column="productCode"/>
        <result property="product_price" column="productPrice"/>
        <result property="shippingfee" column="shippingfee"/>
        <result property="photo" column="photo"/>
        <result property="category_id" column="category_id"/>
    </resultMap>

 	<select id="showproduct" resultMap="productResultMap">
        SELECT *
        FROM products;
    </select>
    
 
    <delete id="deleteProductsFromCart" parameterType="map">
    DELETE FROM bookinglist
    WHERE user_id = #{userId}
    <if test="productIds != null and productIds.size() > 0">
        AND product_id IN
        <foreach item="productId" collection="productIds" open="(" separator="," close=")">
            #{productId}
        </foreach>
    </if>
	</delete>
	
	<select id="showbookingitem" resultMap="bookingListResultMap">
    SELECT b.booking_id, p.productName AS product_name, p.productPrice AS product_price, 
           b.product_count, b.status, b.product_description, 
           p.shippingfee AS shipping_fee, b.product_id, b.user_id
    FROM bookinglist b
    JOIN products p ON b.product_id = p.productId
    WHERE b.user_id = #{userId}
</select>
	
	<select id="getDefaultUserId" resultType="int">
    SELECT id 
    FROM users 
    LIMIT 1;
	</select>
	
	<insert id="insertOrder" parameterType="map">
    	INSERT INTO Orders (user_id, product_id, quantity, created_at, total_price)
    	VALUES (#{userId}, #{productId}, #{quantity}, NOW(), ${totalAmount});
	</insert>

  	<resultMap id="bookingListResultMap" type="com.project.model.BookingList">
        <result property="bookingId" column="booking_id"/>
        <result property="productName" column="product_name"/>
        <result property="productPrice" column="product_price"/>
        <result property="productCount" column="product_count"/>
        <result property="shippingfee" column="shipping_fee"/>
        <result property="status" column="status"/>
        <result property="productdescription" column="product_description"/>
    </resultMap>
  
</mapper> 
